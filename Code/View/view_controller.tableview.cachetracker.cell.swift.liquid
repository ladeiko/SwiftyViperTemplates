{% include 'header' %}

import UIKit

class {{ prefix }}{{ module_info.name }}ViewCell: UITableViewCell {

    // MARK: - Outlets
    // @IBOutlet weak var imageView: UIImageView!
    // TODO: Place your code here

    // MARK: - Vars

//    private static var imageSessionCounter: Int = 0
//    private static func generateSession() -> Int {
//        let value = imageSessionCounter
//        imageSessionCounter = imageSessionCounter.addingReportingOverflow(1).partialValue
//        return value
//    }

//    private var imageSession: Int?
    private var context: {{ prefix }}{{ module_info.name }}ViewCellContext?
    private var model: {{ prefix }}{{ module_info.name }}ModuleEntityModel?

    // MARK: - Public

    func configure(with model: {{ prefix }}{{ module_info.name }}ModuleEntityModel, in context: {{ prefix }}{{ module_info.name }}ViewCellContext) {
        self.context = context
        self.model = model

//        let imageSession: Int = Self.generateSession()
//        self.imageSession = imageSession
//        
//        context.loadModelImage(model) { image in
//
//            assert(Thread.isMainThread)
//
//            guard model == self.model, self.imageSession == imageSession else {
//                return
//            }
//
//            self.imageSession = nil
//            self.imageView.image = image
//        }

        // TODO: Place your code here
    }

    func willDisplay() {
        // TODO: Place your code here
    }

    func stopDisplay() {
        // TODO: Place your code here
    }

    // MARK: - Life cycle

    override func prepareForReuse() {
        super.prepareForReuse()
        model = nil
        context = nil
//        imageSession = nil        
    }

    // MARK: - Helpers
    // TODO: Place your code here

}

#if canImport(SwiftUI) && DEBUG && false // set to true, for preview using SwiftUI
import SwiftUI

@available(iOS 13.0, *)
fileprivate struct {{ prefix }}{{ module_info.name }}ViewCellRepresentable: UIViewControllerRepresentable {
    func updateUIViewController(_ uiViewController: UIViewController, context: Context) {}
    func makeUIViewController(context: Context) -> UIViewController {
        let cell = {{ prefix }}{{ module_info.name }}ViewCell(frame: .zero)
        let controller = UIViewController()   
        controller.view.backgroundColor = .white
        controller.view.addSubview(cell)
        cell.bounds = CGRect(x: 0, y: 0, width: controller.view.bounds.size.width, height: 45)
        cell.center = CGPoint(x: controller.view.bounds.size.width / 2, y: controller.view.bounds.size.height / 2)
        cell.autoresizingMask = [.flexibleWidth, .flexibleTopMargin, .flexibleBottomMargin]
        // TODO: Place your code here
        return controller
    }
}

@available(iOS 13.0, *)
fileprivate struct {{ prefix }}{{ module_info.name }}ViewCell_Previews: PreviewProvider {
    static var previews: some View {
        {{ prefix }}{{ module_info.name }}ViewCellRepresentable()
            .preferredColorScheme(.light)
            //.previewDevice("iPhone X")
        //{{ prefix }}{{ module_info.name }}ViewCellRepresentable()
        //    .preferredColorScheme(.dark)
        //    .previewDevice("iPhone 12")
    }
}
#endif